<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Tracker 2025 - Lengkap</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #4e73df;
            --success: #1cc88a;
            --danger: #e74a3b;
            --bg: #f3f4f6;
            --card-bg: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg); color: #333; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }

        /* HEADER */
        header {
            background: var(--card-bg); padding: 20px; border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        select { padding: 8px 12px; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; }

        /* CARDS */
        .cards-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;
        }
        @media (max-width: 600px) { .cards-grid { grid-template-columns: 1fr; } }
        
        .card {
            background: var(--card-bg); padding: 20px; border-radius: 15px;
            text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }
        .card h3 { font-size: 0.9rem; color: #888; margin-bottom: 5px; }
        .card p { font-size: 1.3rem; font-weight: 600; }
        .c-in { color: var(--success); }
        .c-out { color: var(--danger); }
        .c-bal { color: var(--primary); }

        /* MAIN CONTENT */
        .content-grid {
            display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px;
        }
        @media (max-width: 768px) { .content-grid { grid-template-columns: 1fr; } }

        .box {
            background: var(--card-bg); padding: 25px; border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); margin-bottom: 20px;
        }
        .box h2 { border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.1rem; }

        /* FORM */
        .form-group { margin-bottom: 15px; }
        .form-row { display: flex; gap: 10px; }
        input, select.full { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; }
        button.btn-save {
            width: 100%; padding: 12px; background: var(--primary); color: white;
            border: none; border-radius: 8px; font-weight: 600; cursor: pointer;
        }
        button.btn-save:hover { background: #3a5bbd; }

        /* LIST */
        ul { list-style: none; max-height: 350px; overflow-y: auto; }
        li {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px solid #f0f0f0;
        }
        li:last-child { border: none; }
        .li-left h4 { font-size: 0.9rem; }
        .li-left span { font-size: 0.75rem; color: #aaa; }
        .btn-del {
            margin-left: 10px; background: #ffecec; color: red; border: none;
            padding: 5px 8px; border-radius: 5px; cursor: pointer; font-size: 0.7rem;
        }

        /* CHART */
        .chart-wrap { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 style="color:var(--primary)">üìä Tracker Keuangan</h1>
        <select id="monthSelect" onchange="renderApp()">
            <option value="0">Januari 2025</option>
            <option value="1">Februari 2025</option>
            <option value="2">Maret 2025</option>
            <option value="3">April 2025</option>
            <option value="4">Mei 2025</option>
            <option value="5">Juni 2025</option>
            <option value="6">Juli 2025</option>
            <option value="7">Agustus 2025</option>
            <option value="8">September 2025</option>
            <option value="9">Oktober 2025</option>
            <option value="10">November 2025</option>
            <option value="11">Desember 2025</option>
        </select>
    </header>

    <div class="cards-grid">
        <div class="card">
            <h3>Total Pemasukan</h3>
            <p class="c-in" id="totalIncome">Rp 0</p>
        </div>
        <div class="card">
            <h3>Total Pengeluaran</h3>
            <p class="c-out" id="totalExpense">Rp 0</p>
        </div>
        <div class="card">
            <h3>Sisa Saldo</h3>
            <p class="c-bal" id="totalBalance">Rp 0</p>
        </div>
    </div>

    <div class="content-grid">
        <div>
            <div class="box">
                <h2>‚ûï Tambah Transaksi</h2>
                <form onsubmit="addTransaction(event)">
                    <div class="form-row">
                        <input type="text" id="tName" placeholder="Nama Transaksi" required style="flex:2">
                        <input type="number" id="tAmount" placeholder="Nominal (Rp)" required style="flex:1">
                    </div>
                    <div class="form-row">
                        <select id="tType" class="full" onchange="updateCategoryOptions()">
                            <option value="expense">Pengeluaran</option>
                            <option value="income">Pemasukan</option>
                        </select>
                        <select id="tCategory" class="full">
                            </select>
                    </div>
                    <button type="submit" class="btn-save">Simpan</button>
                </form>
            </div>

            <div class="box">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                    <h2 style="border:none; margin:0;">üìù Riwayat</h2>
                    <button onclick="resetData()" style="font-size:0.7rem; padding:5px; cursor:pointer;">Reset</button>
                </div>
                <ul id="trxList">
                    </ul>
            </div>
        </div>

        <div>
            <div class="box">
                <h2>üìâ Peta Keuangan (In & Out)</h2>
                

[Image of financial pie chart breakdown]

                <div class="chart-wrap">
                    <canvas id="financeChart"></canvas>
                </div>
                <div style="margin-top:15px; text-align:center; font-size:0.8rem; color:#666;">
                    <span style="color:#1cc88a">‚óè Pemasukan</span> | <span style="color:#e74a3b">‚óè Pengeluaran</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 1. SETUP DATA & KONFIGURASI ---
    
    // Daftar Kategori Spesifik
    const incomeCats = ['Gaji', 'Bonus', 'Hasil Usaha', 'Investasi', 'Pemasukan Lain'];
    const expenseCats = ['Makanan', 'Transport', 'Belanja', 'Tagihan', 'Cicilan', 'Lainnya'];
    
    // Warna Chart (Hijau/Biru untuk Income, Merah/Kuning untuk Expense)
    const incomeColors = ['#1cc88a', '#36b9cc', '#4e73df', '#2c9faf', '#858796']; 
    const expenseColors = ['#e74a3b', '#f6c23e', '#e74a3b', '#fd7e14', '#e02d1b', '#858796'];

    // Ambil data dari LocalStorage
    let transactions = JSON.parse(localStorage.getItem('fin_tracker_2025_v2')) || [];

    // Setup Chart JS
    const ctx = document.getElementById('financeChart').getContext('2d');
    let myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
            }
        }
    });

    const formatRupiah = (n) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);

    // --- 2. FUNGSI LOGIKA TAMPILAN (RENDER) ---
    function renderApp() {
        const month = parseInt(document.getElementById('monthSelect').value);
        const dataBulanIni = transactions.filter(t => t.month === month);

        let totIn = 0, totOut = 0;
        const listEl = document.getElementById('trxList');
        listEl.innerHTML = '';

        // Objek untuk menampung total per kategori untuk chart
        // Kita gabung semua kategori income dan expense jadi satu objek tracker
        let chartDataTracker = {};

        dataBulanIni.forEach(t => {
            // Hitung Total
            if(t.type === 'income') totIn += t.amount;
            else totOut += t.amount;

            // Masukkan ke data Chart
            if (!chartDataTracker[t.category]) chartDataTracker[t.category] = { amount: 0, type: t.type };
            chartDataTracker[t.category].amount += t.amount;

            // Render List
            const li = document.createElement('li');
            const color = t.type === 'income' ? 'c-in' : 'c-out';
            const sign = t.type === 'income' ? '+' : '-';
            li.innerHTML = `
                <div class="li-left">
                    <h4>${t.name}</h4>
                    <span>${t.category}</span>
                </div>
                <div style="display:flex; align-items:center">
                    <strong class="${color}">${sign} ${formatRupiah(t.amount)}</strong>
                    <button class="btn-del" onclick="delTrx(${t.id})">X</button>
                </div>
            `;
            listEl.prepend(li);
        });

        if(dataBulanIni.length === 0) listEl.innerHTML = '<p style="text-align:center; color:#ccc; margin-top:20px">Belum ada data.</p>';

        // Update Kartu
        document.getElementById('totalIncome').innerText = formatRupiah(totIn);
        document.getElementById('totalExpense').innerText = formatRupiah(totOut);
        document.getElementById('totalBalance').innerText = formatRupiah(totIn - totOut);

        // Update Chart (Menggabungkan Income & Expense dalam satu lingkaran)
        updateChart(chartDataTracker);
    }

    function updateChart(dataTracker) {
        // Kita harus memilah mana yang masuk array Labels, Data, dan Colors
        let labels = [];
        let data = [];
        let bgColors = [];

        // Loop Income Categories dulu (supaya urut di chart)
        incomeCats.forEach((cat, index) => {
            if(dataTracker[cat] && dataTracker[cat].amount > 0) {
                labels.push(cat);
                data.push(dataTracker[cat].amount);
                bgColors.push(incomeColors[index % incomeColors.length]);
            }
        });

        // Loop Expense Categories
        expenseCats.forEach((cat, index) => {
            if(dataTracker[cat] && dataTracker[cat].amount > 0) {
                labels.push(cat);
                data.push(dataTracker[cat].amount);
                bgColors.push(expenseColors[index % expenseColors.length]);
            }
        });

        // Jika kosong, beri chart dummy abu-abu
        if(data.length === 0) {
            myChart.data.labels = ['Kosong'];
            myChart.data.datasets[0].data = [1];
            myChart.data.datasets[0].backgroundColor = ['#e3e6f0'];
        } else {
            myChart.data.labels = labels;
            myChart.data.datasets[0].data = data;
            myChart.data.datasets[0].backgroundColor = bgColors;
        }
        myChart.update();
    }

    // --- 3. FUNGSI INTERAKSI FORM ---
    
    // Fungsi agar dropdown kategori berubah sesuai Tipe (Income/Expense)
    function updateCategoryOptions() {
        const type = document.getElementById('tType').value;
        const catSelect = document.getElementById('tCategory');
        catSelect.innerHTML = ''; // Kosongkan dulu

        let options = type === 'income' ? incomeCats : expenseCats;

        options.forEach(cat => {
            let opt = document.createElement('option');
            opt.value = cat;
            opt.innerText = cat;
            catSelect.appendChild(opt);
        });
    }

    function addTransaction(e) {
        e.preventDefault();
        const name = document.getElementById('tName').value;
        const amount = parseFloat(document.getElementById('tAmount').value);
        const type = document.getElementById('tType').value;
        const category = document.getElementById('tCategory').value;
        const month = parseInt(document.getElementById('monthSelect').value);

        if(name && amount) {
            transactions.push({
                id: Date.now(),
                name, amount, type, category, month
            });
            localStorage.setItem('fin_tracker_2025_v2', JSON.stringify(transactions));
            
            // Reset Form (kecuali tipe dan kategori biar enak kalau mau input banyak)
            document.getElementById('tName').value = '';
            document.getElementById('tAmount').value = '';
            renderApp();
        }
    }

    function delTrx(id) {
        if(confirm('Hapus item ini?')) {
            transactions = transactions.filter(t => t.id !== id);
            localStorage.setItem('fin_tracker_2025_v2', JSON.stringify(transactions));
            renderApp();
        }
    }

    function resetData() {
        if(confirm('Hapus SEMUA data?')) {
            transactions = [];
            localStorage.setItem('fin_tracker_2025_v2', JSON.stringify([]));
            renderApp();
        }
    }

    // Jalankan saat load
    window.onload = function() {
        updateCategoryOptions(); // Isi dropdown kategori awal
        renderApp(); // Render tampilan
    };

</script>

</body>
</html>